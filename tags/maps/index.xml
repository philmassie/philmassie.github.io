<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Maps on Kabelsalat</title>
    <link>https://philmassie.github.io/tags/maps/</link>
    <description>Recent content in Maps on Kabelsalat</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 14 Jul 2016 00:00:00 +0000</lastBuildDate>
    
        <atom:link href="https://philmassie.github.io/tags/maps/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>South African municipal elections 2016</title>
      <link>https://philmassie.github.io/post/20160714/election_effort/</link>
      <pubDate>Thu, 14 Jul 2016 00:00:00 +0000</pubDate>
      
      <guid>https://philmassie.github.io/post/20160714/election_effort/</guid>
      <description>

&lt;h1 id=&#34;style-for-changing-title-colour-depending-on-photo&#34;&gt;Style for changing title colour depending on photo&lt;/h1&gt;

&lt;p&gt;&lt;style&gt;
   div.post-heading span.meta {
    color: black;
  }
&lt;/style&gt;&lt;/p&gt;

&lt;h1 id=&#34;introduction&#34;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;With South Africa&amp;rsquo;s municipal elections in a few days time (3rd August 2016), I wondered about the effort being expended by the parties in each district or municipality. Has it increased or decreased since the 2011 elections? I must point out that I am not a political analyst or a political scientist. I am nevertheless a scientist with an appreciation for analytics.&lt;/p&gt;

&lt;p&gt;Employing and promoting candidates costs money. Assuming that our political parties don&amp;rsquo;t have infinite financial resources it follows that investigating where they invest their resources may be a reasonable proxy for effort. Furthermore, looking at the change in effort adds a temporal dimension, suggesting where effort has increased or decreased between the elections.&lt;/p&gt;

&lt;p&gt;The map below shows the change in PR candidate representation by each party across the county. If you hover your mouse pointer over a district, you can see by how much the representation has changed in terms of two metrics:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Relative change&lt;/strong&gt;: The change in representation as a proportion of all representatives. E.g. In 2011 parties A and B each had 50% of a district&amp;rsquo;s PR candidates. In 2016 party A has 60% and party B has 40%. Party A&amp;rsquo;s relative change is 10% and party B&amp;rsquo;s is -10%.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Absolute change&lt;/strong&gt;: The change in actual number of PR candidates in a party from 2011 to 2016.&lt;/p&gt;

&lt;p&gt;Scroll below the map for more info regarding data sources and methods.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Disclaimer: As I said though, I am no political scientist and so maybe this is all nonsense.&lt;/em&gt;&lt;/p&gt;

&lt;iframe width=&#34;100%&#34; height=&#34;800px&#34; src=&#34;https://philmassie.github.io/election_effort_d3/za_election_effort_2016.html&#34; scrolling = &#34;no&#34; frameborder=&#34;0&#34; seamless name=&#34;iframe-election-content&#34; id=&#34;iframe-election-content&#34;&gt;
&lt;p&gt;Your browser does not support iframes. Click &lt;a href=&#34;https://philmassie.github.io/election_effort_d3/&#34;&gt;here&lt;/a&gt; to navigate to the content.&lt;/p&gt;
&lt;/iframe&gt;

&lt;p&gt;Embed this map using the following iframe code:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;iframe width=&amp;quot;100%&amp;quot; height=&amp;quot;660px&amp;quot; src=&amp;quot;https://philmassie.github.io/election_effort_d3/za_election_effort_2016.html&amp;quot; scrolling = &amp;quot;no&amp;quot; frameborder=&amp;quot;0&amp;quot; seamless name=&amp;quot;iframe-election-content&amp;quot; id=&amp;quot;iframe-election-content&amp;quot;&amp;gt;
&amp;lt;p&amp;gt;Your browser does not support iframes. Click &amp;lt;a href=&amp;quot;https://philmassie.github.io/election_effort_d3/&amp;quot;&amp;gt;here&amp;lt;/a&amp;gt; to navigate to the content.&amp;lt;/p&amp;gt;
&amp;lt;/iframe&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;data-sources&#34;&gt;Data sources&lt;/h1&gt;

&lt;p&gt;The &lt;a href=&#34;http://www.elections.org.za&#34;&gt;Independent Electoral Commission&lt;/a&gt; have published the &lt;a href=&#34;http://www.elections.org.za/content/Elections/Candidates-lists/&#34;&gt;2016 candidate lists&lt;/a&gt; as pdf documents. The good people at &lt;a href=&#34;https://africaopendata.org/&#34;&gt;openAfrica&lt;/a&gt; have already gone to the trouble of &lt;a href=&#34;https://africaopendata.org/dataset/electoral-candidates-2016&#34;&gt;processing these pdfs&lt;/a&gt; (which can be a bit painful) so I used their lists instead. openAfrica also host the &lt;a href=&#34;https://africaopendata.org/dataset/electoral-commission-of-south-africa-local-government-election-candidates&#34;&gt;2011&lt;/a&gt; candidate lists. After learning a little more about the electoral system, it seemed that the proportional representative candidates would be the interesting group to look at.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&#34;http://www.demarcation.org.za/&#34;&gt;Municipal Demarcation Board&lt;/a&gt; website hosts shape files for South Africa&amp;rsquo;s &lt;a href=&#34;http://www.demarcation.org.za/index.php/downloads/boundary-data/boundary-data-main-files/districts&#34;&gt;districts&lt;/a&gt; and &lt;a href=&#34;http://www.demarcation.org.za/index.php/downloads/boundary-data/boundary-data-main-files/province&#34;&gt;provinces&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&#34;r-data-processing&#34;&gt;R data processing&lt;/h1&gt;

&lt;p&gt;Some simple wrangling in R (scroll down for the process) exposed the list of district codes which I joined with the appropriate candidate lists from each election year. From there I produced a list of parties, ordered by the total number of district or municipal representatives. The Economic Freedom Fighters lead this list with a total of 1501 candidates, 106 more than the African National Congress and 139 more than the Democratic Alliance. These are the three largest parties which is why I mention them. I chose to load the map with ANC data because the EFF didn&amp;rsquo;t exist during the 2011 elections and so they&amp;rsquo;ve not decreased in any provinces. I believe that a few candidates have withdrawn from the elections. I&amp;rsquo;m not sure who they were but I doubt their withdrawal would make any substantive change to this analysis.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span class=&#34;c1&#34;&gt;## Libraries&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;library&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;rgdal&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;library&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;xlsx&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;library&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;plyr&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;library&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;stringr&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;library&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;dplyr&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;span class=&#34;kp&#34;&gt;setwd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;D:/My Folders/R/2016/blog/20160714_election_effort&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Load the district shape file to get a list of district codes&lt;/span&gt;
za.districts &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; readOGR&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Districts&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; layer&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;DistrictMunicipalities2011&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
za.district.list &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;unique&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;za.districts&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;data&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;DISTRICT&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;kp&#34;&gt;rm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;za.districts&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# load and process electoral candidate data&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# 2011 Proportional Representative candidates&lt;/span&gt;
pr.cand.2011 &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; read.xlsx2&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;data/2011-pr-candidate-lists.xls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; startRow &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# A few minor edits to party names&lt;/span&gt;
pr.cand.2011&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; str_to_title&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;str_replace_all&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;pr.cand.2011&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;  &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
pr.cand.2011&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;pr.cand.2011&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Democratic Alliance/Demokratiese Alliansie&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Democratic Alliance&amp;#34;&lt;/span&gt;
pr.cand.2011&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;pr.cand.2011&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Independent Ratepayers Association Of Sa&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Independent Ratepayers Association Of SA&amp;#34;&lt;/span&gt;
pr.cand.2011&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;pr.cand.2011&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;South African Maintanance And Estate Beneficiaries Associati&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;South African Maintanance And Estate Beneficiaries Association&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 2016 ward &amp;amp; proportional Representative candidates were in the same data set&lt;/span&gt;
ward.pr.cand.2016 &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; read.csv&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;data/Electoral_Candidates_2016.csv&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# A few minor edits to party names&lt;/span&gt;
ward.pr.cand.2016&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; str_to_title&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;str_replace_all&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;ward.pr.cand.2016&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;  &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
ward.pr.cand.2016&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;ward.pr.cand.2016&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Independent Ratepayers Association Of Sa&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Independent Ratepayers Association Of SA&amp;#34;&lt;/span&gt;
ward.pr.cand.2016&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;ward.pr.cand.2016&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;South African Maintanance And Estate Beneficiaries Associati&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;South African Maintanance And Estate Beneficiaries Association&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# A number of the 2016 district codes had a wierd &amp;#34;\f&amp;#34; prefix.&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# I consulted the original IEC data,confirmed that these were errors, and tidied them up.&lt;/span&gt;
err_index &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;grep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;\f&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; ward.pr.cand.2016&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Municipality&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
ward.pr.cand.2016&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Municipality&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;err_index&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; str_replace&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;ward.pr.cand.2016&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Municipality&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;err_index&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\f&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
ward.pr.cand.2016 &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;droplevels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;ward.pr.cand.2016&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#### Split the data into ward and pr data&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# change variable names so they match later&lt;/span&gt;
pr.cand.2016 &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;ward.pr.cand.2016&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; ward.pr.cand.2016&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;PR.List.OrderNo...Ward.No &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;kp&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;pr.cand.2016&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;list.order.no&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#### Process ward and PR data&lt;/span&gt;
processor &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kr&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# get the variable name of passed data&lt;/span&gt;
    data.name &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kp&#34;&gt;deparse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kp&#34;&gt;substitute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# split the municipality names into codes and names&lt;/span&gt;
    dist.split &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; str_split_fixed&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Municipality&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; - &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    df&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;dist.code &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; dist.split&lt;span class=&#34;p&#34;&gt;[,&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    df&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;dist.name &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; dist.split&lt;span class=&#34;p&#34;&gt;[,&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# Keep only the district values from the shape file. Main centers and DC areas.&lt;/span&gt;
    df &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; df&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;df&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;dist.code &lt;span class=&#34;o&#34;&gt;%in%&lt;/span&gt; za.district.list&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# split data by district and party, counting how many candidates per party per district&lt;/span&gt;
    df.long &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; ddply&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;dist.code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Party&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;kr&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;nrow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# temp naming - to keep track not NB&lt;/span&gt;
    &lt;span class=&#34;kp&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df.long&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;num&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# split new data by district, summing tot candidates from all parties (in district)&lt;/span&gt;
    df.tot &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; ddply&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df.long&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;dist.code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kr&#34;&gt;function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;num&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# join tot numbers by district to main data&lt;/span&gt;
    df.long &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; join&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df.long&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; df.tot&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; by &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;dist.code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# temp naming - to keep track not NB&lt;/span&gt;
    &lt;span class=&#34;kp&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df.long&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;tot&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# calculate the proportion of each party to total, for each district&lt;/span&gt;
    df.long&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;prop &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; df.long&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;num &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; df.long&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;tot
    &lt;span class=&#34;c1&#34;&gt;# quick srting, not v NB&lt;/span&gt;
    df.long &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; arrange&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df.long&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; dist.code&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;prop&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# renaming based on variable name&lt;/span&gt;
    &lt;span class=&#34;kp&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df.long&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kp&#34;&gt;paste0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;data.name&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.num&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;paste0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;data.name&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.tot&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;paste0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;data.name&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.prop&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
    &lt;span class=&#34;kr&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;df.long&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
pr.cand.2011.long &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; processor&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;pr.cand.2011&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
pr.cand.2016.long &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; processor&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;pr.cand.2016&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Join data, dropping parties that no longer exist&lt;/span&gt;
pr.cand &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; join&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;pr.cand.2011.long&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; pr.cand.2016.long&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; by &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;dist.code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Party&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; type &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;right&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# replace NAs with zero for parties new in 2016&lt;/span&gt;
pr.cand&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kp&#34;&gt;is.na&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;pr.cand&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# calculate relative and absolute change&lt;/span&gt;
pr.cand&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;rel &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; pr.cand&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;pr.cand.2016.prop &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; pr.cand&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;pr.cand.2011.prop
pr.cand&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;abs &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; pr.cand&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;pr.cand.2016.num &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; pr.cand&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;pr.cand.2011.num&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# generate data for d3 map&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# full data list&lt;/span&gt;
d3_data_all &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; pr.cand&lt;span class=&#34;p&#34;&gt;[,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;span class=&#34;kp&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;d3_data_all&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;dist_code&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;party&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Relative Change&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Absolute Change&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
write.csv&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;d3_data_all&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;data_d3/d3_data_all.csv&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; row.names &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;FALSE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; quote &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;FALSE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Party data list, ordered by total number or district PR candidates&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# group the data by Party&lt;/span&gt;
grouped &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; group_by&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;pr.cand&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; Party&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Summarise by summing the total candidates per party, excluding zeros and sorting&lt;/span&gt;
d3_party_list &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; summarise&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;grouped&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; tot &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;pr.cand.2016.num&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
d3_party_list &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; d3_party_list&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;d3_party_list&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;tot &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
d3_party_list &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; arrange&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;d3_party_list&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;tot&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# now we only need the party list&lt;/span&gt;
d3_party_list &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;data.frame&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;party &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; d3_party_list&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;Party&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

write.csv&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;d3_party_list&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;data_d3/d3_party_list.csv&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; row.names &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;FALSE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; quote &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;FALSE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The map was build with JavaScript and the mighty D3 libraries. The source is in my github repo &lt;a href=&#34;https://github.com/philmassie/election_effort_d3&#34;&gt;here&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
